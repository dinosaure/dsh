OASISFormat:             0.4
Name:                    dsh
Version:                 0.1
Synopsis:                Typed Scheme
Authors:                 Romain Calascibetta
License:                 MIT
Plugins:                 META (0.4), DevFiles (0.4)
BuildTools:              ocamlbuild
AlphaFeatures:           ocamlbuild_more_args

Library dsh
  Path:                  src
  Modules:               Loc, ULexer, AParser, UParser, Pattern, Ast,
                         Type, Gamma, Synthesis, Core, Interpreter
  BuildDepends:          batteries, menhirLib, sedlex

Document "dsh"
  Type:                  ocamlbuild (0.4)
  BuildTools:            ocamldoc
  Title:                 "dsh"
  PostCommand:           cp dsh.docdir/*.html doc/
  XOCamlbuildPath:       src
  XOCamlbuildLibraries:  dsh
  XOCamlbuildExtraArgs:
    "-docflags '-colorize-code -keep-code -charset utf-8'"

Executable "top"
  Path:                  top
  MainIs:                top.ml
  BuildDepends:          compiler-libs.toplevel, threads, utop
  ByteOpt:               -linkpkg -linkall -predicates create_toploop
  NativeOpt:             -linkpkg -linkall -predicates create_toploop

Executable dsh
  Path:                  bin
  MainIs:                dsh.ml
  BuildDepends:          dsh, lwt.ppx, lambda-term

## Test ##

Executable test_type
  Path:                  test
  Build$:                flag(tests)
  Install:               false
  CompiledObject:        best
  MainIs:                type_test.ml
  BuildDepends:          dsh, oUnit

Test test_type
  Run$:                  flag(tests)
  TestTools:             test_type
  Command:               $test_type
  WorkingDirectory:      .

Executable test_alias
  Path:                  test
  Build$:                flag(tests)
  Install:               false
  CompiledObject:        best
  MainIs:                alias_test.ml
  BuildDepends:          dsh, oUnit

Test test_alias
  Run$:                  flag(tests)
  TestTools:             test_alias
  Command:               $test_alias
  WorkingDirectory:      .

Executable test_variant
  Path:                  test
  Build$:                flag(tests)
  Install:               false
  CompiledObject:        best
  MainIs:                variant_test.ml
  BuildDepends:          dsh, oUnit

Test test_variant
  Run$:                  flag(tests)
  TestTools:             test_variant
  Command:               $test_variant
  WorkingDirectory:      .
